# ğŸ‰ æ¶æ„åˆå¹¶å®Œæˆ - æ–°ç‰ˆæœ¬è¯´æ˜

## âœ… æ”¹åŠ¨æ€»ç»“

æˆåŠŸå°†**åŸå§‹ç‰ˆæœ¬ (huu)** çš„ Asymmetric Actor-Critic + Frame Stacking ä¸**å½“å‰ç‰ˆæœ¬**çš„é«˜åº¦å›¾æ„ŸçŸ¥åˆå¹¶ï¼

---

## ğŸ“Š æ–°æ¶æ„è¯¦æƒ…

### **Actor: 930D**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å†å²å †å  (15 frames Ã— 47D) = 705D          â”‚
â”‚  æ¯å¸§ 47D:                                   â”‚
â”‚   â€¢ Phase (sin/cos): 2D                     â”‚
â”‚   â€¢ Commands (vx, vy, omega): 3D            â”‚
â”‚   â€¢ Joint positions: 12D                    â”‚
â”‚   â€¢ Joint velocities: 12D                   â”‚
â”‚   â€¢ Previous actions: 12D                   â”‚
â”‚   â€¢ Base angular velocity: 3D               â”‚
â”‚   â€¢ Projected gravity: 3D                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å½“å‰é«˜åº¦å›¾ (ä¸å †å ): 225D                   â”‚
â”‚ (15Ã—15 grid, 1.4m Ã— 1.4m coverage)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         Total: 705 + 225 = 930D
```

### **Critic: 444D**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å†å²å †å  (3 frames Ã— 73D) = 219D           â”‚
â”‚  æ¯å¸§ 73D:                                   â”‚
â”‚   â€¢ Base obs: 41D                           â”‚
â”‚   â€¢ Privileged info: 32D â­                 â”‚
â”‚      - Base linear velocity (3D)            â”‚
â”‚      - Push force/torque (5D)               â”‚
â”‚      - Friction & mass (2D)                 â”‚
â”‚      - Stance & contact masks (4D)          â”‚
â”‚      - Joint error (12D)                    â”‚
â”‚      - Euler angles (3D)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å½“å‰é«˜åº¦å›¾ (ä¸å †å ): 225D                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         Total: 219 + 225 = 444D
```

â­ = Critic ç‰¹æƒä¿¡æ¯ï¼ˆActor æ— æ³•è·å¾—ï¼‰

---

## ğŸ”‘ å…³é”®ç‰¹æ€§

### âœ… **æ—¶é—´å»ºæ¨¡èƒ½åŠ›**
- Actor ä½¿ç”¨ **15 å¸§å†å²**æ¨æ–­é€Ÿåº¦ã€åŠ é€Ÿåº¦ã€åŠ¨æ€è¶‹åŠ¿
- Critic ä½¿ç”¨ **3 å¸§å†å²**å¿«é€Ÿä¼°å€¼
- æ— éœ€ LSTM/GRUï¼Œç»“æ„ç®€å•é«˜æ•ˆ

### âœ… **ç©ºé—´æ„ŸçŸ¥èƒ½åŠ›**
- **15Ã—15 é«˜åº¦å›¾**æä¾›åœ°å½¢ä¿¡æ¯
- è¦†ç›–èŒƒå›´ï¼š1.4m Ã— 1.4mï¼ˆè¶³å¤Ÿå‰ç»ï¼‰
- æ”¯æŒè™šæ‹Ÿåœ°å½¢ï¼ˆStage 1 è®­ç»ƒï¼‰

### âœ… **Asymmetric Actor-Critic**
- Critic æ‹¥æœ‰çœŸå®é€Ÿåº¦ã€æ‘©æ“¦ç³»æ•°ã€è´¨é‡ç­‰**ç‰¹æƒä¿¡æ¯**
- æ›´å‡†ç¡®çš„ä»·å€¼ä¼°è®¡ â†’ æ›´ç¨³å®šçš„è®­ç»ƒ
- ç»å…¸ RL èŒƒå¼ï¼ŒéªŒè¯æœ‰æ•ˆ

### âœ… **å†…å­˜ä¼˜åŒ–**
- é«˜åº¦å›¾**ä¸å †å **ï¼ˆèŠ‚çœ 15Ã—225 = 3375Dï¼ï¼‰
- æ›´åˆç†çš„ç»´åº¦åˆ†é…
- ç©ºé—´ä¿¡æ¯ç›¸å¯¹é™æ€ï¼Œæ— éœ€å†å²

---

## ğŸ†š ç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§ | åŸå§‹ç‰ˆæœ¬ (huu) | ä¹‹å‰ç‰ˆæœ¬ | **æ–°ç‰ˆæœ¬** |
|------|---------------|---------|-----------|
| **Actor è¾“å…¥** | 705D (15Ã—47) | 272D | **930D (15Ã—47+225)** âœ… |
| **Critic è¾“å…¥** | 219D (3Ã—73) | 272D | **444D (3Ã—73+225)** âœ… |
| **Frame Stack** | âœ… 15/3 | âŒ æ—  | âœ… **15/3** |
| **é«˜åº¦å›¾** | âŒ | âœ… å †å  | âœ… **ä»…å½“å‰å¸§** |
| **Asymmetric** | âœ… | âŒ | âœ… **å®Œå…¨æ¢å¤** |
| **ç‰¹æƒä¿¡æ¯** | âœ… ä¸°å¯Œ | âŒ æ—  | âœ… **å®Œæ•´** |
| **Episode é•¿åº¦** | 24s | 96s | **24s** |

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### **1. éªŒè¯é…ç½®ï¼ˆæ¨èï¼‰**
```bash
cd /workspace_robot/humanoid-gym
python verify_architecture.py
```

åº”è¯¥çœ‹åˆ°ï¼š
```
âœ… ALL DIMENSIONS VERIFIED SUCCESSFULLY!
Actor: 930D
Critic: 444D
```

### **2. å¼€å§‹è®­ç»ƒï¼ˆä¸è¦ --resumeï¼ï¼‰**

âš ï¸ **é‡è¦**ï¼šç”±äºè§‚æµ‹ç»´åº¦æ”¹å˜ï¼Œ**ä¸èƒ½ä»æ—§ checkpoint resume**ï¼

```bash
cd /workspace_robot/humanoid-gym

# Stage 1: Plane + è™šæ‹ŸçŸ³å¤´ï¼ˆæ¨èï¼‰
python scripts/train.py \
    --task=humanoid_stones_stage1_plane_ppo \
    --run_name new_arch_v1 \
    --double_critic \
    --headless \
    --platform_width=2.0 \
    --platform_length=2.0

# åŸºç¡€è®­ç»ƒ
python scripts/train.py \
    --task=humanoid_ppo \
    --run_name new_arch_base
```

### **3. æŸ¥çœ‹è®­ç»ƒæ—¥å¿—**

å¯åŠ¨æ—¶åº”è¯¥çœ‹åˆ°ï¼š
```
Actor MLP: Sequential(
  (0): Linear(in_features=930, out_features=768, ...)  âœ…
  ...
)
Critic MLP: Sequential(
  (0): Linear(in_features=444, out_features=768, ...)  âœ…
  ...
)
```

**å¦‚æœçœ‹åˆ° 272Dï¼Œè¯´æ˜è¿è¡Œçš„æ˜¯é”™è¯¯çš„ä»£ç åº“ï¼**

### **4. ç›‘æ§è®­ç»ƒ**
```bash
tensorboard --logdir logs/
```

å…³æ³¨æŒ‡æ ‡ï¼š
- `rewards/tracking_lin_vel`: é€Ÿåº¦è·Ÿè¸ªï¼ˆåº” > 0.8ï¼‰
- `rewards/foothold`: Foothold è´¨é‡ï¼ˆåº” > 0ï¼‰
- `policy_loss` / `value_loss`: åº”æ”¶æ•›

---

## âš ï¸ é‡è¦æç¤º

### **å…³äº --resume**

ç”±äºè§‚æµ‹ç»´åº¦ä» 272D æ”¹ä¸º 930D/444Dï¼Œ**ä¸èƒ½ resume æ—§ checkpoint**ï¼

å¦‚æœå¼ºåˆ¶ resumeï¼Œä¼šæŠ¥é”™ï¼š
```python
RuntimeError: mat1 and mat2 shapes cannot be multiplied 
(batch_size x 930 and 272 x 512)
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. âœ… **ä»å¤´è®­ç»ƒ**ï¼ˆæ¨èï¼‰
2. âŒ ä¸è¦ç”¨ `--resume`
3. âœ… è®­ç»ƒæ–°æ¨¡å‹åï¼Œå¯ä»¥ resume æ–°æ¨¡å‹

### **è®­ç»ƒæ–°æ¨¡å‹åçš„ Resume**
```bash
# ç¬¬ä¸€æ¬¡è®­ç»ƒï¼ˆåˆ›å»ºæ–° checkpointï¼‰
python scripts/train.py --task=... --run_name new_v1

# åç»­å¯ä»¥ resumeï¼ˆç»´åº¦åŒ¹é…ï¼‰
python scripts/train.py --task=... --run_name new_v1 --resume
```

---

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### **ä¼˜åŠ¿ï¼ˆç›¸æ¯”ä¹‹å‰ç‰ˆæœ¬ï¼‰**
1. âœ… **æ›´å¼ºçš„æ—¶é—´å»ºæ¨¡** - 15 å¸§å†å² vs 1 å¸§
2. âœ… **æ›´å‡†ç¡®çš„ä»·å€¼ä¼°è®¡** - Critic ç‰¹æƒä¿¡æ¯
3. âœ… **æ›´ç¨³å®šçš„è®­ç»ƒ** - Asymmetric AC
4. âœ… **æ›´å¿«çš„æ”¶æ•›** - æ›´å¥½çš„è§‚æµ‹

### **ä¼˜åŠ¿ï¼ˆç›¸æ¯”åŸå§‹ç‰ˆæœ¬ï¼‰**
1. âœ… **æ›´å¥½çš„åœ°å½¢é€‚åº”** - æœ‰é«˜åº¦å›¾
2. âœ… **æ›´å®‰å…¨çš„ foothold** - æ„ŸçŸ¥åœ°å½¢
3. âœ… **æ”¯æŒå¤æ‚åœ°å½¢** - stones, beams ç­‰

---

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

### 1. `humanoid/envs/custom/humanoid_config.py`
- âœ… è§‚æµ‹ç»´åº¦ï¼š930D / 444D
- âœ… Frame stackingï¼š15 / 3
- âœ… ç½‘ç»œæ¶æ„ï¼š768-512-256

### 2. `humanoid/envs/custom/humanoid_env.py`
- âœ… `compute_observations()`ï¼šåˆ†ç¦» Actor/Critic è§‚æµ‹
- âœ… å†å²å †å é€»è¾‘
- âœ… æ¢å¤ Critic ç‰¹æƒä¿¡æ¯
- âœ… é«˜åº¦å›¾ä¸å †å 
- âœ… `_get_noise_scale_vec()`ï¼šè°ƒæ•´å™ªå£°ç»´åº¦

---

## ğŸ¯ è®­ç»ƒå»ºè®®

### **è¶…å‚æ•°**
å½“å‰é…ç½®å·²ä¼˜åŒ–ï¼š
- Learning rate: 1e-5
- Gamma: 0.994
- Lambda: 0.9
- Episode length: 24s

### **è°ƒè¯•**
- å¦‚æœä¸ç¨³å®šï¼šé™ä½ `noise_level` (å½“å‰ 0.6)
- å¦‚æœ Critic åå·®å¤§ï¼šå¢åŠ  `c_frame_stack` åˆ° 5
- å¦‚æœ Actor æ…¢ï¼šå‡å°‘ `frame_stack` åˆ° 10

---

## ğŸ“š å‚è€ƒ

- **åŸå§‹ç‰ˆæœ¬**: `/workspace_robot/huu/humanoid/envs/custom/`
- **éªŒè¯è„šæœ¬**: `verify_architecture.py`
- **é…ç½®æ–‡ä»¶**: `humanoid/envs/custom/humanoid_config.py`

---

**Status**: âœ… Ready for Training  
**Date**: 2025-12-31  
**Version**: 1.0

ç¥è®­ç»ƒé¡ºåˆ©ï¼ğŸ‰

